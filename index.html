<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EcoBloom</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#06080a;
  --surface:#0d1117;
  --border:rgba(255,170,48,.1);
  --amber:#ffaa30;
  --amber-dim:rgba(255,170,48,.6);
  --amber-soft:rgba(255,170,48,.08);
  --text:#e8dcc8;
  --muted:rgba(232,220,200,.45);
  --white:#fff;
  --r:12px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{
  font-family:'Inter',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
  cursor:none;
}

/* â”€â”€â”€ CURSOR â”€â”€â”€ */
#c-dot,#c-ring{
  position:fixed;top:0;left:0;
  pointer-events:none;z-index:99999;
  border-radius:50%;
  transform:translate(-50%,-50%);
  will-change:transform;
}
#c-dot{
  width:6px;height:6px;
  background:var(--amber);
  box-shadow:0 0 8px var(--amber);
}
#c-ring{
  width:24px;height:24px;
  border:1px solid rgba(255,170,48,.5);
  transition:width .2s,height .2s,border-color .2s,opacity .2s;
}
#c-spin{
  position:fixed;top:0;left:0;
  width:30px;height:30px;
  border-radius:50%;
  border-top:1px solid var(--amber);
  border-right:1px solid transparent;
  border-bottom:1px solid transparent;
  border-left:1px solid transparent;
  transform:translate(-50%,-50%);
  pointer-events:none;z-index:99998;
  opacity:0;
  will-change:transform;
}
/* Target hover state */
.is-target #c-ring{
  width:40px;height:40px;
  border-color:var(--amber);
}
.is-target #c-dot{opacity:0;}

/* â”€â”€â”€ STARFIELD â”€â”€â”€ */
#stars{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;}
.s{position:absolute;border-radius:50%;background:var(--amber);
  animation:tw var(--d,3s) var(--dl,0s) ease-in-out infinite alternate;}
@keyframes tw{0%{opacity:.03;}100%{opacity:.55;}}

/* â”€â”€â”€ NAV â”€â”€â”€ */
nav{
  position:fixed;top:0;left:0;right:0;z-index:100;
  height:60px;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 40px;
  background:rgba(6,8,10,.8);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}
.logo{
  font-family:'Instrument Serif',serif;
  font-size:1.25rem;color:var(--white);
  letter-spacing:-.01em;
  display:flex;align-items:center;gap:8px;
}
.logo-dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--amber);
  box-shadow:0 0 10px var(--amber);
  animation:pulse-dot 2s ease-in-out infinite;
}
@keyframes pulse-dot{0%,100%{transform:scale(1);opacity:1;}50%{transform:scale(1.4);opacity:.7;}}
nav ul{display:flex;gap:4px;list-style:none;}
nav a{
  color:var(--muted);text-decoration:none;
  font-size:.78rem;letter-spacing:.06em;text-transform:uppercase;
  padding:6px 14px;border-radius:6px;
  cursor:none;transition:all .2s;
}
nav a:hover{color:var(--text);background:rgba(255,255,255,.05);}
nav a.active{color:var(--amber);}

/* â”€â”€â”€ PAGES â”€â”€â”€ */
.page{display:none;padding-top:60px;}
.page.active{display:block;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero{
  min-height:calc(100vh - 60px);
  display:grid;
  grid-template-columns:1fr 520px;
  gap:0;
  align-items:stretch;
}

/* LEFT: narrative */
.hero-left{
  padding:80px 60px 60px;
  display:flex;flex-direction:column;justify-content:center;
  border-right:1px solid var(--border);
}
.hero-eyebrow{
  display:inline-flex;align-items:center;gap:8px;
  font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;
  color:var(--amber);margin-bottom:28px;
}
.hero-eyebrow span{
  width:24px;height:1px;background:var(--amber);opacity:.6;
}
.hero-h1{
  font-family:'Instrument Serif',serif;
  font-size:clamp(2.8rem,4.5vw,4.2rem);
  font-weight:400;line-height:1.08;
  color:var(--white);
  letter-spacing:-.02em;
  margin-bottom:24px;
}
.hero-h1 em{color:var(--amber);font-style:italic;}
.hero-body{
  font-size:.95rem;line-height:1.75;
  color:var(--muted);max-width:460px;
  margin-bottom:44px;
}
.hero-actions{display:flex;gap:12px;align-items:center;}
.btn-primary{
  display:inline-flex;align-items:center;gap:8px;
  background:var(--amber);color:#0a0600;
  font-size:.8rem;font-weight:500;letter-spacing:.04em;text-transform:uppercase;
  padding:10px 22px;border-radius:8px;border:none;cursor:none;
  transition:all .2s;white-space:nowrap;
}
.btn-primary:hover{background:#ffc240;transform:translateY(-1px);}
.btn-ghost{
  display:inline-flex;align-items:center;gap:8px;
  color:var(--muted);font-size:.78rem;
  letter-spacing:.04em;text-transform:uppercase;
  padding:10px 18px;border-radius:8px;border:1px solid var(--border);
  background:transparent;cursor:none;transition:all .2s;white-space:nowrap;
}
.btn-ghost:hover{color:var(--text);border-color:rgba(255,170,48,.3);}

/* Stats row below CTA */
.hero-stats{
  display:flex;gap:32px;
  margin-top:52px;
  padding-top:36px;
  border-top:1px solid var(--border);
}
.hero-stat-n{
  font-family:'Instrument Serif',serif;
  font-size:2rem;color:var(--white);
  margin-bottom:3px;
}
.hero-stat-l{font-size:.75rem;color:var(--muted);}

/* RIGHT: live world canvas */
.hero-right{
  position:relative;
  background:var(--surface);
  overflow:hidden;
}
#worldCanvas{display:block;width:100%;height:100%;}
.canvas-label{
  position:absolute;bottom:20px;left:50%;transform:translateX(-50%);
  font-size:.7rem;letter-spacing:.08em;text-transform:uppercase;
  color:var(--muted);white-space:nowrap;
  display:flex;align-items:center;gap:8px;
}
.canvas-label::before,.canvas-label::after{
  content:'';width:20px;height:1px;background:var(--muted);opacity:.4;
}
/* HUD overlay on canvas */
.canvas-hud{
  position:absolute;top:16px;left:16px;right:16px;
  display:flex;justify-content:space-between;
  pointer-events:none;
}
.hud-pill{
  background:rgba(6,8,10,.7);
  border:1px solid var(--border);
  border-radius:100px;
  padding:5px 14px;
  font-size:.72rem;color:var(--muted);
  display:flex;align-items:center;gap:6px;
  backdrop-filter:blur(8px);
}
.hud-pill b{color:var(--amber);font-family:'Instrument Serif',serif;font-size:.95rem;font-weight:400;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NARRATIVE STRIP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.narrative{
  display:grid;grid-template-columns:repeat(3,1fr);
  border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);
}
.narrative-item{
  padding:40px 44px;
  border-right:1px solid var(--border);
  position:relative;
}
.narrative-item:last-child{border-right:none;}
.n-num{
  font-family:'Instrument Serif',serif;
  font-size:3.5rem;color:var(--amber);
  opacity:.15;
  position:absolute;top:28px;right:28px;
  line-height:1;
}
.n-icon{font-size:1.6rem;margin-bottom:14px;}
.n-title{font-size:.95rem;font-weight:500;color:var(--white);margin-bottom:8px;}
.n-desc{font-size:.83rem;line-height:1.7;color:var(--muted);}
/* Connected by arrow */
.narrative-item:not(:last-child)::after{
  content:'â†’';
  position:absolute;right:-14px;top:50%;
  transform:translateY(-50%);
  color:var(--amber);font-size:1rem;opacity:.4;
  z-index:1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ECO TIPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section{padding:80px 60px;}
.section-header{
  display:flex;align-items:flex-end;justify-content:space-between;
  margin-bottom:40px;
}
.section-label{
  font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;
  color:var(--amber);margin-bottom:10px;
}
.section-title{
  font-family:'Instrument Serif',serif;
  font-size:2.2rem;font-weight:400;
  color:var(--white);letter-spacing:-.01em;
}
.tips-grid{
  display:grid;grid-template-columns:repeat(3,1fr);gap:1px;
  background:var(--border);
  border:1px solid var(--border);
  border-radius:var(--r);overflow:hidden;
}
.tip{
  background:var(--bg);
  padding:28px;
  transition:background .2s;
}
.tip:hover{background:var(--surface);}
.tip-icon{font-size:1.4rem;margin-bottom:14px;}
.tip-title{font-size:.9rem;font-weight:500;color:var(--white);margin-bottom:7px;}
.tip-desc{font-size:.8rem;line-height:1.7;color:var(--muted);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUIZ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.quiz-wrap{
  max-width:600px;margin:0 auto;
  padding:48px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:16px;
}
.quiz-top{text-align:center;margin-bottom:32px;}
.quiz-top h2{font-family:'Instrument Serif',serif;font-size:1.8rem;color:var(--white);margin-bottom:6px;}
.quiz-top p{font-size:.82rem;color:var(--muted);}
.qbar{display:flex;gap:5px;margin-bottom:28px;}
.qb{flex:1;height:2px;border-radius:2px;background:rgba(255,170,48,.12);transition:background .3s;}
.qb.done{background:var(--amber);}
.qb.cur{background:rgba(255,170,48,.5);}
.qbox{display:none;}
.qbox.active{display:block;}
.q-label{font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;color:var(--amber);margin-bottom:8px;}
.q-text{font-size:1rem;color:var(--white);line-height:1.6;margin-bottom:20px;font-family:'Instrument Serif',serif;}
.q-opts{display:flex;flex-direction:column;gap:8px;}
.q-opt{
  padding:12px 18px;
  background:transparent;
  border:1px solid var(--border);
  border-radius:8px;
  color:var(--muted);font-size:.85rem;
  text-align:left;cursor:none;transition:all .2s;
  font-family:'Inter',sans-serif;
}
.q-opt:hover:not(:disabled){border-color:rgba(255,170,48,.35);color:var(--text);background:var(--amber-soft);}
.q-opt.correct{border-color:var(--amber);background:rgba(255,170,48,.1);color:var(--amber);}
.q-opt.wrong{border-color:rgba(255,80,80,.4);background:rgba(255,80,80,.07);color:rgba(255,160,160,.8);}
.q-result{text-align:center;padding:16px 0;}
.q-score{font-family:'Instrument Serif',serif;font-size:3.5rem;color:var(--amber);}
.q-msg{font-size:.85rem;color:var(--muted);margin-top:10px;line-height:1.6;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE 2 â€” ECO WORLD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.world-header{
  padding:60px 60px 40px;
  display:grid;grid-template-columns:1fr 1fr;gap:60px;align-items:center;
  border-bottom:1px solid var(--border);
}
.world-canvas-wrap{
  position:relative;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:16px;overflow:hidden;
  aspect-ratio:4/3;
}
#worldCanvas2{display:block;width:100%;height:100%;}
.game-controls{
  display:flex;gap:10px;align-items:center;
  padding:16px 0 0;flex-wrap:wrap;
}
.gstat{
  font-size:.75rem;color:var(--muted);
  padding:6px 14px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:6px;
}
.gstat b{color:var(--amber);}

/* Facts */
.facts-row{
  display:grid;grid-template-columns:repeat(3,1fr);
  gap:1px;background:var(--border);
  border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);
}
.fact{background:var(--bg);padding:36px 40px;}
.fact-n{
  font-family:'Instrument Serif',serif;
  font-size:2.8rem;color:var(--white);
  margin-bottom:8px;letter-spacing:-.02em;
}
.fact-n span{color:var(--amber);}
.fact-d{font-size:.82rem;color:var(--muted);line-height:1.7;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACKEND
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.backend-section{padding:80px 60px;}
.backend-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;}
.bcard{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r);
  padding:28px;
  transition:border-color .2s;
}
.bcard:hover{border-color:rgba(255,170,48,.25);}
.bcard-title{font-size:.9rem;font-weight:500;color:var(--white);margin-bottom:4px;}
.bcard-sub{font-size:.77rem;color:var(--muted);margin-bottom:20px;line-height:1.5;}
.field{margin-bottom:12px;}
.field label{display:block;font-size:.68rem;letter-spacing:.08em;text-transform:uppercase;color:rgba(255,170,48,.6);margin-bottom:5px;}
.field input,.field textarea,.field select{
  width:100%;padding:9px 13px;
  background:rgba(255,255,255,.03);
  border:1px solid var(--border);
  border-radius:7px;color:var(--text);
  font-family:'Inter',sans-serif;font-size:.83rem;
  outline:none;cursor:none;transition:border-color .2s;
}
.field input:focus,.field textarea:focus,.field select:focus{border-color:rgba(255,170,48,.4);}
.field textarea{height:76px;resize:none;}
.field select option{background:#0d1117;}
.res-box{
  margin-top:10px;padding:11px 14px;
  background:rgba(255,255,255,.02);
  border:1px solid var(--border);
  border-radius:7px;
  font-size:.77rem;color:var(--muted);
  min-height:52px;white-space:pre-wrap;line-height:1.6;
}
.lb-row{display:flex;align-items:center;gap:10px;padding:7px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.82rem;}
.lb-r{font-family:'Instrument Serif',serif;font-size:1rem;color:var(--amber);min-width:22px;}
.lb-n{flex:1;color:var(--text);}
.lb-s{color:rgba(255,170,48,.7);font-size:.78rem;}

/* â”€â”€â”€ BLOOM FX â”€â”€â”€ */
.bfx-ring{position:fixed;pointer-events:none;z-index:9000;border-radius:50%;border:1px solid var(--amber);animation:bfx-r .7s ease-out forwards;}
@keyframes bfx-r{0%{transform:translate(-50%,-50%) scale(0);opacity:.8;}100%{transform:translate(-50%,-50%) scale(3.5);opacity:0;}}
.bfx-p{position:fixed;pointer-events:none;z-index:9001;border-radius:50%;animation:bfx-pf 1.2s ease-out forwards;}
@keyframes bfx-pf{0%{transform:translate(-50%,-50%) scale(0);opacity:1;}100%{transform:translate(-50%,-200%) scale(1);opacity:0;}}
.bfx-txt{position:fixed;pointer-events:none;z-index:9002;font-family:'Instrument Serif',serif;font-size:1.3rem;color:var(--amber);animation:bfx-tf 1.2s ease-out forwards;white-space:nowrap;letter-spacing:.02em;}
@keyframes bfx-tf{0%{transform:translate(-50%,-50%) scale(.5);opacity:1;}30%{transform:translate(-50%,-50%) scale(1.05);}100%{transform:translate(-50%,-130%) scale(.9);opacity:0;}}

/* â”€â”€â”€ TICKER â”€â”€â”€ */
.ticker-wrap{
  overflow:hidden;padding:12px 0;
  border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);
}
.ticker{display:flex;gap:48px;animation:tick 28s linear infinite;white-space:nowrap;}
@keyframes tick{0%{transform:translateX(0);}100%{transform:translateX(-50%);}}
.ticker span{font-size:.73rem;color:var(--muted);letter-spacing:.05em;}
.ticker span b{color:var(--amber-dim);}

/* â”€â”€â”€ LOADER â”€â”€â”€ */
.ld{display:inline-block;width:11px;height:11px;border:1.5px solid rgba(255,170,48,.2);border-top-color:var(--amber);border-radius:50%;animation:spin .6s linear infinite;margin-right:6px;vertical-align:middle;}
@keyframes spin{to{transform:rotate(360deg);}}

/* â”€â”€â”€ TOAST â”€â”€â”€ */
#toast{
  position:fixed;bottom:24px;right:24px;z-index:9999;
  background:var(--surface);border:1px solid rgba(255,170,48,.25);
  color:var(--text);padding:11px 18px;border-radius:8px;
  font-size:.8rem;max-width:280px;
  backdrop-filter:blur(20px);
  box-shadow:0 8px 32px rgba(0,0,0,.4);
  transform:translateY(80px);opacity:0;
  transition:all .35s cubic-bezier(.34,1.56,.64,1);
}
#toast.show{transform:translateY(0);opacity:1;}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
@media(max-width:960px){
  .hero{grid-template-columns:1fr;}
  .hero-right{height:380px;}
  .narrative{grid-template-columns:1fr;}
  .narrative-item{border-right:none;border-bottom:1px solid var(--border);}
  .narrative-item:last-child{border-bottom:none;}
  .narrative-item::after{display:none;}
  .tips-grid{grid-template-columns:1fr;}
  .world-header{grid-template-columns:1fr;}
  .facts-row{grid-template-columns:1fr;}
  .backend-grid{grid-template-columns:1fr;}
  .hero-left,.section,.backend-section{padding-left:24px;padding-right:24px;}
  .world-header{padding:40px 24px;}
  nav{padding:0 20px;}
}
</style>
</head>
<body class="">

<!-- CURSOR -->
<div id="c-dot"></div>
<div id="c-ring"></div>
<div id="c-spin"></div>

<!-- STARS -->
<div id="stars"></div>

<!-- TOAST -->
<div id="toast"></div>

<!-- NAV -->
<nav>
  <div class="logo cursor-target">
    <div class="logo-dot"></div>
    EcoBloom
  </div>
  <ul>
    <li><a href="#" class="nav-link active cursor-target" data-page="p1">Learn</a></li>
    <li><a href="#" class="nav-link cursor-target" data-page="p2">Eco World</a></li>
  </ul>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE 1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="p1">

  <!-- HERO -->
  <section class="hero">
    <!-- Left: narrative -->
    <div class="hero-left">
      <div class="hero-eyebrow"><span></span>Green Earth Initiative<span></span></div>

      <h1 class="hero-h1">
        The rat collects.<br>
        The bottle blooms.<br>
        <em>The world heals.</em>
      </h1>

      <p class="hero-body">
        Three elements â€” one living ecosystem. Every plastic bottle the rat recycles flows as energy into the flower's roots. Watch the bloom grow in real time as you play, learn, and act. This is what eco-consciousness looks like when it's alive.
      </p>

      <div class="hero-actions">
        <button class="btn-primary cursor-target" onclick="document.getElementById('quiz-section').scrollIntoView({behavior:'smooth'})">
          Take the Quiz
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 6h8M6 2l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="btn-ghost cursor-target" onclick="startWorld()">Enter Eco World</button>
      </div>

      <div class="hero-stats">
        <div>
          <div class="hero-stat-n" id="sc1">0</div>
          <div class="hero-stat-l">Tons COâ‚‚ saved<br>daily by cyclists</div>
        </div>
        <div style="width:1px;background:var(--border);"></div>
        <div>
          <div class="hero-stat-n" id="sc2">0</div>
          <div class="hero-stat-l">% of ocean plastic<br>from land sources</div>
        </div>
        <div style="width:1px;background:var(--border);"></div>
        <div>
          <div class="hero-stat-n" id="sc3">0</div>
          <div class="hero-stat-l">Species lost yearly<br>to deforestation</div>
        </div>
      </div>
    </div>

    <!-- Right: Live World Canvas -->
    <div class="hero-right" id="heroCanvasWrap">
      <canvas id="worldCanvas"></canvas>
      <div class="canvas-hud">
        <div class="hud-pill">ğŸŒ¸ Bloom <b id="h-bloom">0%</b></div>
        <div class="hud-pill">ğŸ¶ <b id="h-bottles">0</b> recycled</div>
      </div>
      <div class="canvas-label">drag petals Â· arrow keys to move rat</div>
    </div>
  </section>

  <!-- NARRATIVE: how the 3 connect -->
  <div class="narrative">
    <div class="narrative-item cursor-target">
      <div class="n-num">01</div>
      <div class="n-icon">ğŸ€</div>
      <div class="n-title">The Rat Moves</div>
      <div class="n-desc">Use arrow keys or WASD to move the Eco Rat across the living world. The rat is your agent of change in this ecosystem.</div>
    </div>
    <div class="narrative-item cursor-target">
      <div class="n-num">02</div>
      <div class="n-icon">ğŸ¶</div>
      <div class="n-title">Bottles Get Recycled</div>
      <div class="n-desc">Bottles drift through the world. When the rat touches one, it's recycled â€” not just a game point, but real energy sent to the roots.</div>
    </div>
    <div class="narrative-item cursor-target">
      <div class="n-num">03</div>
      <div class="n-icon">ğŸŒ¸</div>
      <div class="n-title">The World Blooms</div>
      <div class="n-desc">Every bottle recycled extends the petals. The flower's bloom is a live, accurate measure of your eco impact. They are one.</div>
    </div>
  </div>

  <!-- TICKER -->
  <div class="ticker-wrap">
    <div class="ticker">
      <span>ğŸ€ Rat collects <b>bottles</b></span>
      <span>ğŸ¶ Bottles feed the <b>bloom</b></span>
      <span>ğŸŒ¸ Bloom measures your <b>impact</b></span>
      <span>â™»ï¸ One world. <b>Three elements.</b></span>
      <span>ğŸŒ Recycle more â†’ <b>bloom more</b></span>
      <span>ğŸ€ Rat collects <b>bottles</b></span>
      <span>ğŸ¶ Bottles feed the <b>bloom</b></span>
      <span>ğŸŒ¸ Bloom measures your <b>impact</b></span>
      <span>â™»ï¸ One world. <b>Three elements.</b></span>
      <span>ğŸŒ Recycle more â†’ <b>bloom more</b></span>
    </div>
  </div>

  <!-- ECO TIPS -->
  <div class="section">
    <div class="section-header">
      <div>
        <div class="section-label">Green Habits</div>
        <div class="section-title">Six ways to let the world bloom</div>
      </div>
    </div>
    <div class="tips-grid">
      <div class="tip cursor-target"><div class="tip-icon">ğŸ’§</div><div class="tip-title">Conserve Water</div><div class="tip-desc">A running tap wastes 6 litres per minute. Small daily habits bloom into thousands of litres saved each year.</div></div>
      <div class="tip cursor-target"><div class="tip-icon">ğŸš´</div><div class="tip-title">Green Transport</div><div class="tip-desc">Cycling twice a week significantly cuts your carbon footprint and lets your personal health bloom alongside the planet.</div></div>
      <div class="tip cursor-target"><div class="tip-icon">ğŸ¥—</div><div class="tip-title">Plant-Based Meals</div><div class="tip-desc">One meatless day saves 1,100 litres of water. Plant-forward diets let ecosystems recover and bloom naturally.</div></div>
      <div class="tip cursor-target"><div class="tip-icon">â™»ï¸</div><div class="tip-title">Recycle Everything</div><div class="tip-desc">Every bottle sorted correctly is a seed planted. Recycled materials bloom into new products, reducing raw extraction.</div></div>
      <div class="tip cursor-target"><div class="tip-icon">ğŸŒ³</div><div class="tip-title">Plant Trees</div><div class="tip-desc">A single tree absorbs 21 kg of COâ‚‚ yearly. Communities that plant together watch entire landscapes bloom back to life.</div></div>
      <div class="tip cursor-target"><div class="tip-icon">âš¡</div><div class="tip-title">Renewable Energy</div><div class="tip-desc">Solar and wind let our planet bloom without pollution. Your switch to renewables directly reduces what the rat must dodge.</div></div>
    </div>
  </div>

  <!-- QUIZ -->
  <div class="section" id="quiz-section" style="padding-top:0;">
    <div class="section-header">
      <div>
        <div class="section-label">Test Your Knowledge</div>
        <div class="section-title">Bloom Quiz</div>
      </div>
      <div style="font-size:.8rem;color:var(--muted);">Each correct answer blooms the world</div>
    </div>
    <div class="quiz-wrap">
      <div class="qbar" id="qbar">
        <div class="qb cur" id="qb0"></div><div class="qb" id="qb1"></div>
        <div class="qb" id="qb2"></div><div class="qb" id="qb3"></div><div class="qb" id="qb4"></div>
      </div>

      <div class="qbox active" id="q0">
        <div class="q-label">01 / 05</div>
        <div class="q-text">How long does a plastic bottle take to decompose in a landfill?</div>
        <div class="q-opts">
          <button class="q-opt cursor-target" onclick="ans(this,false,0)">10 â€“ 20 years</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,0)">50 â€“ 100 years</button>
          <button class="q-opt cursor-target" onclick="ans(this,true,0)">400 â€“ 500 years</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,0)">1,000+ years</button>
        </div>
      </div>
      <div class="qbox" id="q1">
        <div class="q-label">02 / 05</div>
        <div class="q-text">Which gas is the primary driver of climate change from human activity?</div>
        <div class="q-opts">
          <button class="q-opt cursor-target" onclick="ans(this,false,1)">Oxygen</button>
          <button class="q-opt cursor-target" onclick="ans(this,true,1)">Carbon Dioxide (COâ‚‚)</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,1)">Nitrogen</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,1)">Hydrogen</button>
        </div>
      </div>
      <div class="qbox" id="q2">
        <div class="q-label">03 / 05</div>
        <div class="q-text">What fraction of Earth's freshwater is actually available for human use?</div>
        <div class="q-opts">
          <button class="q-opt cursor-target" onclick="ans(this,false,2)">25%</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,2)">10%</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,2)">5%</button>
          <button class="q-opt cursor-target" onclick="ans(this,true,2)">Less than 1%</button>
        </div>
      </div>
      <div class="qbox" id="q3">
        <div class="q-label">04 / 05</div>
        <div class="q-text">How many trees are felled globally every minute?</div>
        <div class="q-opts">
          <button class="q-opt cursor-target" onclick="ans(this,false,3)">50 trees</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,3)">500 trees</button>
          <button class="q-opt cursor-target" onclick="ans(this,true,3)">2,400 trees</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,3)">10,000 trees</button>
        </div>
      </div>
      <div class="qbox" id="q4">
        <div class="q-label">05 / 05</div>
        <div class="q-text">What single action causes a local ecosystem to truly bloom?</div>
        <div class="q-opts">
          <button class="q-opt cursor-target" onclick="ans(this,false,4)">Using more plastic packaging</button>
          <button class="q-opt cursor-target" onclick="ans(this,true,4)">Planting native wildflowers & trees</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,4)">Burning garden waste</button>
          <button class="q-opt cursor-target" onclick="ans(this,false,4)">Paving over gardens</button>
        </div>
      </div>
      <div class="qbox" id="q5">
        <div class="q-result">
          <div class="q-score" id="q-final">0/5</div>
          <div class="q-msg" id="q-msg"></div>
          <button class="btn-ghost cursor-target" style="margin-top:20px;" onclick="resetQ()">Try again</button>
        </div>
      </div>
    </div>
  </div>

</div><!-- /p1 -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE 2: ECO WORLD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="p2">

  <div class="world-header">
    <div>
      <div class="section-label" style="margin-bottom:10px;">One Living Ecosystem</div>
      <h1 style="font-family:'Instrument Serif',serif;font-size:clamp(2.2rem,4vw,3.4rem);font-weight:400;color:var(--white);letter-spacing:-.02em;line-height:1.1;margin-bottom:18px;">
        Rat. Bottle.<br><span style="color:var(--amber);font-style:italic;">Bloom.</span>
      </h1>
      <p style="font-size:.88rem;line-height:1.75;color:var(--muted);max-width:420px;margin-bottom:28px;">
        The three are inseparable. Move the rat to collect bottles. Each bottle recycled feeds energy into the flower's roots â€” petals extend in real-time. Pollution hits shrink the bloom. The flower is a live, accurate mirror of your eco impact.
      </p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn-primary cursor-target" id="startBtn" onclick="startGame()">â–¶ Start Game</button>
        <button class="btn-ghost cursor-target" onclick="resetGame()">Reset</button>
      </div>
      <div class="game-controls" id="game-stats">
        <div class="gstat">Score <b id="g-score">0</b></div>
        <div class="gstat">Bottles <b id="g-bottles">0</b></div>
        <div class="gstat">Level <b id="g-level">1</b></div>
        <div class="gstat">Lives <b id="g-lives">â™¥â™¥â™¥</b></div>
      </div>
    </div>

    <div>
      <div class="world-canvas-wrap" id="gameCanvasWrap">
        <canvas id="worldCanvas2"></canvas>
      </div>
    </div>
  </div>

  <!-- Facts -->
  <div class="facts-row">
    <div class="fact cursor-target">
      <div class="fact-n"><span>80</span>%</div>
      <div class="fact-d">of plastic bottles end up in landfills or oceans. Every bottle the rat misses is energy the flower never receives.</div>
    </div>
    <div class="fact cursor-target">
      <div class="fact-n">1 <span style="font-size:1.8rem">bottle</span></div>
      <div class="fact-d">recycled can power a 60W bulb for 6 hours. In EcoBloom, that energy flows directly into the flower's bloom.</div>
    </div>
    <div class="fact cursor-target">
      <div class="fact-n"><span>25</span></div>
      <div class="fact-d">PET bottles carefully recycled bloom into enough fibres for one fleece jacket. Collect 25 to reach full bloom.</div>
    </div>
  </div>

  <!-- Backend -->
  <div class="backend-section">
    <div style="margin-bottom:36px;">
      <div class="section-label" style="margin-bottom:8px;">Community</div>
      <div class="section-title">Track your impact</div>
    </div>
    <div class="backend-grid">
      <!-- Pledge -->
      <div class="bcard">
        <div class="bcard-title">Eco Pledge</div>
        <div class="bcard-sub">Make a public commitment to the planet</div>
        <div class="field"><label>Name</label><input id="pname" type="text" placeholder="Your name" class="cursor-target"></div>
        <div class="field"><label>Your Pledge</label><textarea id="ptext" placeholder="I will recycle every bottle I use..." class="cursor-target"></textarea></div>
        <button class="btn-primary cursor-target" onclick="submitPledge()" style="width:100%;justify-content:center;">Submit Pledge</button>
        <div class="res-box" id="pledgeRes">Your pledge will appear here.</div>
      </div>
      <!-- AI Tip -->
      <div class="bcard">
        <div class="bcard-title">AI Eco Tip</div>
        <div class="bcard-sub">Personalised tip from Claude based on your lifestyle</div>
        <div class="field"><label>Lifestyle</label>
          <select id="ls" class="cursor-target">
            <option value="student">Student / Young Adult</option>
            <option value="parent">Parent with Family</option>
            <option value="office">Office Worker</option>
            <option value="rural">Rural Living</option>
            <option value="urban">Urban City Dweller</option>
          </select>
        </div>
        <div class="field"><label>Biggest Challenge</label>
          <select id="ch" class="cursor-target">
            <option value="plastic">Reducing Plastic</option>
            <option value="energy">Saving Energy</option>
            <option value="food">Food Waste</option>
            <option value="transport">Green Transport</option>
          </select>
        </div>
        <button class="btn-primary cursor-target" onclick="getAITip()" style="width:100%;justify-content:center;">Generate Tip</button>
        <div class="res-box" id="aiRes">Your tip will appear here.</div>
      </div>
      <!-- Leaderboard -->
      <div class="bcard">
        <div class="bcard-title">Leaderboard</div>
        <div class="bcard-sub">Submit your combined score and compete</div>
        <div class="field"><label>Name</label><input id="lbname" type="text" placeholder="Your name" class="cursor-target"></div>
        <div style="display:flex;gap:8px;margin-bottom:12px;">
          <button class="btn-primary cursor-target" onclick="submitScore()" style="flex:1;justify-content:center;">Submit</button>
          <button class="btn-ghost cursor-target" onclick="loadLB()" style="flex:1;justify-content:center;">Refresh</button>
        </div>
        <div id="lbDisplay"><div class="ld"></div></div>
      </div>
    </div>
  </div>

</div><!-- /p2 -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STARS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(()=>{
  const c=document.getElementById('stars');
  for(let i=0;i<90;i++){
    const el=document.createElement('div');el.className='s';
    const sz=Math.random()*1.8+.3;
    el.style.cssText=`width:${sz}px;height:${sz}px;top:${Math.random()*100}%;left:${Math.random()*100}%;opacity:.2;--d:${2+Math.random()*4}s;--dl:${Math.random()*4}s;`;
    c.appendChild(el);
  }
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GSAP TARGET CURSOR
   - Small 6px dot follows instantly
   - 24px ring lags with parallax (parallaxOn)
   - Spinning arc appears when on .cursor-target
   - Ring gently enlarges to hug element on hover (NOT oversized)
   - spinDuration=2, hoverDuration=0.2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function TargetCursor({ spinDuration=2, hoverDuration=0.2, parallaxOn=true, hideDefaultCursor=true }={}){
  if(hideDefaultCursor) document.body.style.cursor='none';

  const dot  = document.getElementById('c-dot');
  const ring = document.getElementById('c-ring');
  const spin = document.getElementById('c-spin');

  let mx=window.innerWidth/2, my=window.innerHeight/2;
  let rx=mx, ry=my;
  let onEl=false;

  // Spinning arc: continuous GSAP rotation
  const spinTween = gsap.to(spin, {
    rotation:360, duration:spinDuration,
    ease:'none', repeat:-1, paused:true
  });

  document.addEventListener('mousemove',e=>{ mx=e.clientX; my=e.clientY; });

  // Render loop
  gsap.ticker.add(()=>{
    // Dot: instant
    gsap.set(dot,{ x:mx, y:my });
    // Ring: parallax lag
    rx += (mx-rx) * (parallaxOn ? 0.14 : 0.5);
    ry += (my-ry) * (parallaxOn ? 0.14 : 0.5);
    if(!onEl) gsap.set(ring,{ x:rx, y:ry });
    gsap.set(spin,{ x:rx, y:ry });
  });

  // Hover on .cursor-target: ring hugs element tightly
  document.addEventListener('mouseover',e=>{
    const t=e.target.closest('.cursor-target');
    if(!t||onEl) return;
    onEl=true;
    const r=t.getBoundingClientRect();
    // Ring size = element's shorter dimension + small padding (max 48px)
    const pad=10;
    const sz=Math.min(Math.min(r.width,r.height)+pad, 48);

    document.body.classList.add('is-target');
    spinTween.play();

    // Snap ring to element centre
    gsap.to(ring,{
      x: r.left+r.width/2,
      y: r.top+r.height/2,
      width:sz, height:sz,
      border:'1.5px solid var(--amber)',
      duration:hoverDuration,
      ease:'power2.out'
    });
    gsap.to(spin,{ opacity:0.6, duration:hoverDuration });
  });

  document.addEventListener('mouseout',e=>{
    const t=e.target.closest('.cursor-target');
    if(!t) return;
    onEl=false;
    document.body.classList.remove('is-target');
    spinTween.pause();
    gsap.to(ring,{ width:24, height:24, border:'1px solid rgba(255,170,48,.5)', duration:hoverDuration, ease:'power2.out' });
    gsap.to(spin,{ opacity:0, duration:hoverDuration });
  });

  // Click: quick pulse
  document.addEventListener('click',()=>{
    gsap.fromTo(dot,{ scale:1 },{ scale:2.2, duration:.12, yoyo:true, repeat:1, ease:'power2.out' });
  });

  // Update ring on scroll
  window.addEventListener('scroll',()=>{ if(onEl) onEl=false; });

})({ spinDuration:2, hoverDuration:0.2, parallaxOn:true, hideDefaultCursor:true });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.querySelectorAll('.nav-link').forEach(l=>{
  l.addEventListener('click',e=>{
    e.preventDefault();
    const id=l.dataset.page;
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.querySelectorAll('.nav-link').forEach(a=>a.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    l.classList.add('active');
    window.scrollTo(0,0);
    if(id==='p2'){ initGame(); loadLB(); }
  });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COUNTERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function counter(id,to,sfx=''){
  let v=0;const el=document.getElementById(id);const s=to/55;
  const t=setInterval(()=>{ v=Math.min(v+s,to);el.textContent=Math.round(v)+sfx;if(v>=to)clearInterval(t); },20);
}
setTimeout(()=>{ counter('sc1',7400,'+'); counter('sc2',80,'%'); counter('sc3',1000,'+'); },400);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED ECO STATE â€” the connective tissue
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const eco = {
  bottles:0,
  score:0,
  quizBonus:0,
  get bloom(){ return Math.min(1, this.bottles/22 + this.quizBonus*.04); }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BLOOM DOM FX â€” subtle & proportionate
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function bloomFX(x,y){
  // Ring
  const rng=document.createElement('div');rng.className='bfx-ring';
  rng.style.cssText=`left:${x}px;top:${y}px;width:20px;height:20px;`;
  document.body.appendChild(rng);setTimeout(()=>rng.remove(),700);
  // Label
  const txt=document.createElement('div');txt.className='bfx-txt';
  txt.textContent='bloom';txt.style.cssText=`left:${x}px;top:${y}px;`;
  document.body.appendChild(txt);setTimeout(()=>txt.remove(),1200);
  // Particles
  for(let i=0;i<8;i++){
    const p=document.createElement('div');p.className='bfx-p';
    const sz=3+Math.random()*5+'px';
    p.style.cssText=`left:${x+(Math.random()-.5)*60}px;top:${y+(Math.random()-.5)*30}px;width:${sz};height:${sz};background:var(--amber);box-shadow:0 0 6px var(--amber);animation-duration:${.8+Math.random()*.5}s;`;
    document.body.appendChild(p);setTimeout(()=>p.remove(),1300);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORLD CANVAS â€” Hero (passive, draggable petals)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const hCanvas = document.getElementById('worldCanvas');
const hCtx    = hCanvas.getContext('2d');
let hW=0,hH=0;

function resizeHero(){
  const wrap=document.getElementById('heroCanvasWrap');
  hW=wrap.clientWidth; hH=wrap.clientHeight;
  hCanvas.width=hW*devicePixelRatio; hCanvas.height=hH*devicePixelRatio;
  hCanvas.style.width=hW+'px'; hCanvas.style.height=hH+'px';
  hCtx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}

const hFlower = { petals:[], sideFlowers:[], init(){ this.petals=[]; for(let i=0;i<10;i++) this.petals.push({ base:i*(Math.PI*2/10)-Math.PI/2, drag:0,vdrag:0,len:0,tLen:60+Math.random()*20, w:26+Math.random()*10,hov:false,drag_:false,sa:0 }); this.sideFlowers=[{xf:.28,yf:.52,r:26,ph:.6,pc:6,bloom:0},{xf:.72,yf:.50,r:22,ph:1.3,pc:6,bloom:0}]; } };
hFlower.init();
let hTime=0;
const hMouse={x:0,y:0};

hCanvas.addEventListener('mousemove',e=>{
  const r=hCanvas.getBoundingClientRect();
  hMouse.x=(e.clientX-r.left);hMouse.y=(e.clientY-r.top);
  const fc={x:hW*.5,y:hH*.3};
  hFlower.petals.forEach(p=>{
    if(p.drag_){const a=Math.atan2(hMouse.y-fc.y,hMouse.x-fc.x);p.vdrag=(a-p.base-p.sa-p.drag)*.28;}
    else p.hov=pHit(hMouse.x,hMouse.y,p,fc.x,fc.y);
  });
});
hCanvas.addEventListener('mousedown',e=>{
  const r=hCanvas.getBoundingClientRect();hMouse.x=(e.clientX-r.left);hMouse.y=(e.clientY-r.top);
  const fc={x:hW*.5,y:hH*.3};
  hFlower.petals.forEach(p=>{ if(pHit(hMouse.x,hMouse.y,p,fc.x,fc.y)){p.drag_=true;p.sa=Math.atan2(hMouse.y-fc.y,hMouse.x-fc.x)-p.base-p.drag;} });
});
hCanvas.addEventListener('mouseup',()=>hFlower.petals.forEach(p=>p.drag_=false));
hCanvas.addEventListener('mouseleave',()=>hFlower.petals.forEach(p=>{p.drag_=false;p.hov=false;}));

function pHit(px,py,p,cx,cy){
  const a=p.base+p.drag;return Math.sqrt((px-cx-Math.cos(a)*p.len*.88)**2+(py-cy-Math.sin(a)*p.len*.88)**2)<p.w*.8;
}

function hDraw(){
  hCtx.clearRect(0,0,hW,hH);
  const bl=eco.bloom;
  // BG
  hCtx.fillStyle='#0d1117';hCtx.fillRect(0,0,hW,hH);
  // Glow behind flower
  const g=hCtx.createRadialGradient(hW*.5,hH*.3,5,hW*.5,hH*.3,160+bl*80);
  g.addColorStop(0,`rgba(255,140,30,${.05+bl*.12})`);g.addColorStop(1,'transparent');
  hCtx.fillStyle=g;hCtx.fillRect(0,0,hW,hH);
  // Stars
  for(let i=0;i<40;i++){
    const x=(i*173+hTime*2)%hW,y=(i*137)%hH;
    const opa=.04+Math.sin(hTime*1.2+i)*.04;
    hCtx.fillStyle=`rgba(255,200,100,${opa})`;hCtx.beginPath();hCtx.arc(x,y,.8,0,Math.PI*2);hCtx.fill();
  }
  const cx=hW*.5,cy=hH*.3;
  // Ground
  hCtx.fillStyle='rgba(30,18,5,.6)';hCtx.fillRect(0,hH*.82,hW,hH*.18);
  const gg=hCtx.createLinearGradient(0,hH*.82,0,hH);
  gg.addColorStop(0,'rgba(40,22,6,.7)');gg.addColorStop(1,'rgba(10,6,2,1)');
  hCtx.fillStyle=gg;hCtx.fillRect(0,hH*.82,hW,hH*.18);
  // Grass
  drawGrass(hCtx,hW,hH,hTime,bl);
  // Stem
  drawStem(hCtx,cx,cy,hW,hH,hTime,bl);
  // Side flowers
  hFlower.sideFlowers.forEach((sf,si)=>{sf.bloom+=(bl-sf.bloom)*.04;drawSideFlower(hCtx,sf,hW,hH,hTime);});
  // Petals
  hFlower.petals.forEach((p,i)=>{
    p.tLen=58+bl*52;p.len+=(p.tLen-p.len)*.04;
    if(!p.drag_){p.vdrag-=p.drag*.16;p.vdrag*=.72;p.drag+=p.vdrag;}
    else{p.drag+=p.vdrag;p.vdrag*=.62;}
    drawPetal(hCtx,cx,cy,p,i,bl,hTime);
  });
  drawCenter(hCtx,cx,cy,12+bl*8,bl,hTime);
  // Fireflies
  for(let i=0;i<3+Math.floor(bl*5);i++){
    const fx=hW*.15+Math.sin(hTime*.3+i*1.9)*hW*.35;
    const fy=hH*.1+Math.cos(hTime*.25+i*2.3)*hH*.28;
    const gv=.3+Math.sin(hTime*2+i)*.25;
    const fg=hCtx.createRadialGradient(fx,fy,0,fx,fy,5+bl*3);
    fg.addColorStop(0,`rgba(255,180,50,${gv})`);fg.addColorStop(1,'transparent');
    hCtx.fillStyle=fg;hCtx.beginPath();hCtx.arc(fx,fy,5+bl*3,0,Math.PI*2);hCtx.fill();
    hCtx.fillStyle=`rgba(255,240,180,${gv})`;hCtx.beginPath();hCtx.arc(fx,fy,1.2,0,Math.PI*2);hCtx.fill();
  }
  document.getElementById('h-bloom').textContent=Math.round(bl*100)+'%';
  document.getElementById('h-bottles').textContent=eco.bottles;
  hTime+=.016;
  requestAnimationFrame(hDraw);
}

// â”€â”€ SHARED DRAW FUNCTIONS â”€â”€
function drawGrass(c,W,H,t,bl){
  const blades=[];
  for(let i=0;i<24;i++) blades.push({x:(i/24)*W,h:22+Math.sin(i*17)*18+bl*15,w:2+Math.sin(i*7)*.8,ph:i*.8,side:i%2?1:-1});
  blades.forEach(g=>{
    const sw=Math.sin(t*.9+g.ph)*4;
    c.save();c.translate(g.x,H*.82);c.beginPath();c.moveTo(0,0);
    c.bezierCurveTo(g.side*g.w*2.5+sw,-g.h*.4,g.side*g.w*3+sw*1.5,-g.h*.75,g.side*g.w*1.5+sw*2,-g.h);
    c.lineWidth=g.w+bl;
    const gr=c.createLinearGradient(0,0,0,-g.h);
    gr.addColorStop(0,'rgba(60,35,5,.8)');gr.addColorStop(.6,`rgba(${100+bl*40},${55+bl*20},10,.9)`);gr.addColorStop(1,`rgba(${160+bl*40},${90+bl*30},20,1)`);
    c.strokeStyle=gr;c.lineCap='round';c.stroke();c.restore();
  });
}
function drawStem(c,cx,cy,W,H,t,bl){
  const sw=Math.sin(t*.45)*(2.5+bl*4);
  c.beginPath();c.moveTo(cx,H*.82);c.bezierCurveTo(cx+sw,H*.65,cx-sw,H*.48,cx,cy+16);
  const sg=c.createLinearGradient(cx,H*.82,cx,cy);
  sg.addColorStop(0,'#1a0a00');sg.addColorStop(.5,'#5a2800');sg.addColorStop(1,'#9a5000');
  c.strokeStyle=sg;c.lineWidth=6+bl*4;c.lineCap='round';c.stroke();
  if(bl>.15){c.save();c.filter=`blur(${3+bl*5}px)`;c.globalAlpha=bl*.25;c.beginPath();c.moveTo(cx,H*.82);c.bezierCurveTo(cx+sw,H*.65,cx-sw,H*.48,cx,cy+16);c.strokeStyle=`rgba(255,150,40,${bl*.5})`;c.lineWidth=12;c.stroke();c.restore();c.filter='none';}
  [[.42,-1],[.58,1],[.68,-1]].forEach(([tv,side])=>{
    const lx=cx+sw*(1-tv);const ly=cy+(H*.82-cy)*tv;
    const len=32+tv*20+bl*12;const ang=.42+bl*.1;
    c.save();c.translate(lx,ly);c.rotate(side*(ang+Math.sin(t*.5+side)*.06));
    c.beginPath();c.moveTo(0,0);c.bezierCurveTo(len*.35,-len*.25,len*.85,-len*.12,len,0);c.bezierCurveTo(len*.85,len*.12,len*.35,len*.2,0,0);
    const lg=c.createLinearGradient(0,0,len,0);lg.addColorStop(0,'#1a0a00');lg.addColorStop(1,`hsl(${28+bl*8},${50+bl*18}%,${20+bl*16}%)`);
    c.fillStyle=lg;c.fill();c.restore();
  });
}
function drawSideFlower(c,sf,W,H,t){
  const bl=sf.bloom;if(bl<.04)return;
  const cx=W*sf.xf,cy=H*sf.yf;const sw=Math.sin(t*.6+sf.ph)*3*bl;
  c.beginPath();c.moveTo(cx,H*.82);c.quadraticCurveTo(cx-sw*2,cy+(H*.82-cy)*.5,cx,cy+sf.r);
  const sg=c.createLinearGradient(cx,H*.82,cx,cy);sg.addColorStop(0,'#1a0a00');sg.addColorStop(1,'#9a5000');
  c.strokeStyle=sg;c.lineWidth=3+bl*2;c.lineCap='round';c.stroke();
  for(let i=0;i<sf.pc;i++){
    const a=i*(Math.PI*2/sf.pc)+t*.15+sf.ph;
    const px=cx+Math.cos(a)*sf.r*bl,py=cy+Math.sin(a)*sf.r*bl*.9;
    c.beginPath();c.ellipse(px,py,sf.r*.4*bl,sf.r*.24*bl,a,0,Math.PI*2);
    const pg=c.createRadialGradient(px,py,0,px,py,sf.r*.4);
    pg.addColorStop(0,'rgba(255,240,190,.9)');pg.addColorStop(.5,`hsla(${sf.ph>1?28:35},68%,68%,.85)`);pg.addColorStop(1,`hsla(30,65%,38%,.7)`);
    c.fillStyle=pg;c.fill();
  }
  c.beginPath();c.arc(cx,cy,sf.r*.2*bl,0,Math.PI*2);c.fillStyle='#f5d84a';c.fill();
}
function drawPetal(c,cx,cy,p,i,bl,t){
  const a=p.base+p.drag+Math.sin(t*.65+i)*.04;
  const len=p.len,w=p.w;
  const sy=1-Math.abs(Math.sin(a+Math.PI/2)*.18)*.28;
  c.save();c.translate(cx,cy);c.rotate(a);c.scale(1,sy);
  // Shadow
  c.beginPath();c.ellipse(len*.48,len*.07,len*.5,w*.32,0,0,Math.PI*2);c.fillStyle='rgba(0,0,0,.12)';c.fill();
  // Body
  c.beginPath();c.moveTo(0,0);c.bezierCurveTo(w*.5,-len*.27,len*.87,-w*.5,len,0);c.bezierCurveTo(len*.87,w*.5,w*.5,len*.27,0,0);
  const h=p.hov||p.drag_;
  const pg=c.createLinearGradient(0,-w*.4,len*.85,w*.38);
  pg.addColorStop(0,  h?'rgba(255,248,215,.98)':'rgba(255,235,190,.92)');
  pg.addColorStop(.2, h?'rgba(255,210,110,.95)':'rgba(255,190,90,.88)');
  pg.addColorStop(.55,`hsla(${35+i*2},${63+bl*16}%,${58+bl*12}%,.9)`);
  pg.addColorStop(.85,`hsla(${28+i*3},${66+bl*14}%,${40+bl*10}%,.84)`);
  pg.addColorStop(1,  `hsla(${22+i*4},70%,${24+bl*12}%,.76)`);
  c.fillStyle=pg;c.fill();
  c.strokeStyle=`rgba(255,225,130,${h?.4:.14+bl*.1})`;c.lineWidth=h?1.5:.8;c.stroke();
  // Vein
  c.beginPath();c.moveTo(2,0);c.bezierCurveTo(len*.28,0,len*.62,.4,len*.87,0);
  c.strokeStyle=`rgba(255,238,180,${h?.25:.08+bl*.07})`;c.lineWidth=.8;c.stroke();
  if(bl>.5&&(h||bl>.82)){
    const sh=c.createRadialGradient(len*.28,-w*.12,0,len*.28,-w*.12,w*.55);
    sh.addColorStop(0,`rgba(255,255,220,${bl*.16})`);sh.addColorStop(1,'transparent');
    c.fillStyle=sh;c.beginPath();c.moveTo(0,0);c.bezierCurveTo(w*.5,-len*.27,len*.87,-w*.5,len,0);c.bezierCurveTo(len*.87,w*.5,w*.5,len*.27,0,0);c.fill();
  }
  c.restore();
}
function drawCenter(c,cx,cy,r,bl,t){
  const gl=c.createRadialGradient(cx,cy,0,cx,cy,r*3);
  gl.addColorStop(0,`rgba(255,140,30,${.16+bl*.18})`);gl.addColorStop(1,'transparent');
  c.fillStyle=gl;c.beginPath();c.arc(cx,cy,r*3,0,Math.PI*2);c.fill();
  if(bl>.3){c.save();c.filter=`blur(${2+bl*6}px)`;c.globalAlpha=bl*.32;c.beginPath();c.arc(cx,cy,r*1.4,0,Math.PI*2);c.fillStyle=`rgba(255,200,60,${bl*.65})`;c.fill();c.restore();c.filter='none';}
  const cg=c.createRadialGradient(cx-r*.2,cy-r*.2,r*.06,cx,cy,r);
  cg.addColorStop(0,'#fffde0');cg.addColorStop(.3,'#f5e64a');cg.addColorStop(.7,'#e0960a');cg.addColorStop(1,'#7a4000');
  c.beginPath();c.arc(cx,cy,r,0,Math.PI*2);c.fillStyle=cg;c.fill();
  c.fillStyle='rgba(0,0,0,.2)';
  for(let i=0;i<14;i++){const a=i*(Math.PI*2/14)+t*.2;c.beginPath();c.arc(cx+Math.cos(a)*r*.55,cy+Math.sin(a)*r*.55,1.1,0,Math.PI*2);c.fill();}
  c.beginPath();c.arc(cx,cy,r*.35,0,Math.PI*2);c.fillStyle='rgba(255,240,100,.45)';c.fill();
}

// Start hero canvas
function startHeroCanvas(){
  resizeHero();
  hDraw();
}
window.addEventListener('resize',()=>{hCtx.setTransform(1,0,0,1,0,0);resizeHero();});
startHeroCanvas();
function startWorld(){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-link').forEach(a=>a.classList.remove('active'));
  document.getElementById('p2').classList.add('active');
  document.querySelector('[data-page="p2"]').classList.add('active');
  window.scrollTo(0,0);
  initGame();loadLB();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME CANVAS (Page 2) â€” Rat + Bottles share eco state
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const gCanvas = document.getElementById('worldCanvas2');
const gCtx    = gCanvas.getContext('2d');
let gW=0,gH=0,gRunning=false,gTime=0;
let gFlower={petals:[],sideFlowers:[],init(){this.petals=[];for(let i=0;i<10;i++)this.petals.push({base:i*(Math.PI*2/10)-Math.PI/2,drag:0,vdrag:0,len:0,tLen:60+Math.random()*20,w:26+Math.random()*10,hov:false,drag_:false,sa:0});this.sideFlowers=[{xf:.28,yf:.52,r:26,ph:.6,pc:6,bloom:0},{xf:.72,yf:.5,r:22,ph:1.3,pc:6,bloom:0}];}};
gFlower.init();

function resizeGame(){
  const wrap=document.getElementById('gameCanvasWrap');
  gW=wrap.clientWidth;gH=wrap.clientHeight;
  gCanvas.width=gW*devicePixelRatio;gCanvas.height=gH*devicePixelRatio;
  gCanvas.style.width=gW+'px';gCanvas.style.height=gH+'px';
  gCtx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}

const rat={x:80,y:0,face:1,bob:0};
let bottles=[],polls=[],btimer=0,ptimer=0,frame=0,level=1,lives=3;
const keys={};
document.addEventListener('keydown',e=>{keys[e.key]=true;if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key))e.preventDefault();});
document.addEventListener('keyup',e=>{keys[e.key]=false;});

const BTYPES=[{e:'ğŸ¶',c:'#ffaa30',g:'rgba(255,170,48,',pts:10},{e:'ğŸ¾',c:'#ffc850',g:'rgba(255,200,80,',pts:15},{e:'ğŸ¥¤',c:'#e6821e',g:'rgba(230,130,30,',pts:10},{e:'ğŸ«™',c:'#c8b43c',g:'rgba(200,180,60,',pts:15}];
const POLLS=['ğŸ­','ğŸ’¨','ğŸ›¢ï¸','â˜ ï¸'];

function initGame(){
  if(gW===0) resizeGame();
  rat.x=80;rat.y=gH*.75;bottles=[];polls=[];btimer=0;ptimer=0;frame=0;level=1;lives=3;
  gFlower.init();
  for(let i=0;i<3;i++) spawnB(true);
  if(!gRunning) gLoop();
}
function spawnB(sc=false){
  const bt=BTYPES[Math.floor(Math.random()*BTYPES.length)];
  bottles.push({x:sc?60+Math.random()*(gW-120):gW+20,y:gH*.6+Math.random()*(gH*.22),vx:sc?0:-(1.3+Math.random()*level*.4),bob:Math.random()*Math.PI*2,gp:Math.random()*Math.PI*2,sz:18+Math.random()*7,...bt});
}
function spawnP(){
  polls.push({x:gW+20,y:gH*.5+Math.random()*(gH*.32),vx:-(1.1+Math.random()*level*.3),e:POLLS[Math.floor(Math.random()*POLLS.length)],r:18});
}

function gLoop(){
  gRunning=true;gTime+=.016;frame++;
  gCtx.clearRect(0,0,gW,gH);
  const bl=eco.bloom;

  // BG
  gCtx.fillStyle='#0d1117';gCtx.fillRect(0,0,gW,gH);
  const gb=gCtx.createRadialGradient(gW*.5,gH*.28,5,gW*.5,gH*.28,160+bl*80);
  gb.addColorStop(0,`rgba(255,120,30,${.04+bl*.1})`);gb.addColorStop(1,'transparent');
  gCtx.fillStyle=gb;gCtx.fillRect(0,0,gW,gH);

  drawGrass(gCtx,gW,gH,gTime,bl);
  // Ground
  const gg=gCtx.createLinearGradient(0,gH*.82,0,gH);gg.addColorStop(0,'rgba(40,22,6,.7)');gg.addColorStop(1,'rgba(10,6,2,1)');
  gCtx.fillStyle=gg;gCtx.fillRect(0,gH*.82,gW,gH*.18);
  drawStem(gCtx,gW*.5,gH*.28,gW,gH,gTime,bl);
  gFlower.sideFlowers.forEach(sf=>{sf.bloom+=(bl-sf.bloom)*.04;drawSideFlower(gCtx,sf,gW,gH,gTime);});
  gFlower.petals.forEach((p,i)=>{
    p.tLen=58+bl*52;p.len+=(p.tLen-p.len)*.04;
    if(!p.drag_){p.vdrag-=p.drag*.16;p.vdrag*=.72;p.drag+=p.vdrag;}
    drawPetal(gCtx,gW*.5,gH*.28,p,i,bl,gTime);
  });
  drawCenter(gCtx,gW*.5,gH*.28,12+bl*8,bl,gTime);
  // Aura rings
  if(bl>.05){for(let r=0;r<Math.floor(bl*3)+1;r++){const rr=(gTime*.25+r*.55)%1;gCtx.save();gCtx.globalAlpha=(1-rr)*bl*.12;gCtx.beginPath();gCtx.arc(gW*.5,gH*.28,(45+bl*75)*rr,0,Math.PI*2);gCtx.strokeStyle=`rgba(255,150,40,${bl*.6})`;gCtx.lineWidth=1.2;gCtx.stroke();gCtx.restore();}}
  // Fireflies
  for(let i=0;i<2+Math.floor(bl*5);i++){const fx=gW*.12+Math.sin(gTime*.32+i*1.9)*gW*.38;const fy=gH*.08+Math.cos(gTime*.25+i*2.3)*gH*.26;const gv=.25+Math.sin(gTime*2+i)*.22;const fg=gCtx.createRadialGradient(fx,fy,0,fx,fy,4+bl*3);fg.addColorStop(0,`rgba(255,180,50,${gv})`);fg.addColorStop(1,'transparent');gCtx.fillStyle=fg;gCtx.beginPath();gCtx.arc(fx,fy,4+bl*3,0,Math.PI*2);gCtx.fill();}

  if(gRunning){
    // Spawn
    btimer++;ptimer++;
    if(btimer>100){spawnB();btimer=0;}
    if(ptimer>180){spawnP();ptimer=0;}
    if(frame%500===0){level++;document.getElementById('g-level').textContent=level;}
    // Move rat
    const sp=3.5+level*.3;let mv=false;
    if(keys['ArrowLeft']||keys['a']||keys['A']){rat.x-=sp;rat.face=-1;mv=true;}
    if(keys['ArrowRight']||keys['d']||keys['D']){rat.x+=sp;rat.face=1;mv=true;}
    if(keys['ArrowUp']||keys['w']||keys['W']){rat.y-=sp;mv=true;}
    if(keys['ArrowDown']||keys['s']||keys['S']){rat.y+=sp;mv=true;}
    rat.x=Math.max(18,Math.min(gW-18,rat.x));rat.y=Math.max(gH*.4,Math.min(gH*.88,rat.y));
    rat.bob+=mv?.16:.04;
    // Bottles
    bottles=bottles.filter(b=>{
      b.x+=b.vx;b.bob+=.04;b.gp+=.05;
      if(b.x<-30)return false;
      const by=b.y+Math.sin(b.bob)*3;
      const gl=gCtx.createRadialGradient(b.x,by,2,b.x,by,22);
      gl.addColorStop(0,b.g+(0.2+Math.sin(b.gp)*.08)+')');gl.addColorStop(1,'transparent');
      gCtx.fillStyle=gl;gCtx.beginPath();gCtx.arc(b.x,by,22,0,Math.PI*2);gCtx.fill();
      gCtx.font=`${b.sz}px serif`;gCtx.textAlign='center';gCtx.textBaseline='middle';gCtx.fillText(b.e,b.x,by);
      // Proximity ring
      const dd=Math.sqrt((rat.x-b.x)**2+(rat.y-by)**2);
      if(dd<70){gCtx.save();gCtx.globalAlpha=.25+(.5-.5*Math.cos(gTime*8))*.3;gCtx.beginPath();gCtx.arc(b.x,by,20+Math.sin(gTime*8)*6,0,Math.PI*2);gCtx.strokeStyle=b.c;gCtx.lineWidth=1.5;gCtx.stroke();gCtx.restore();}
      if(dd<20){eco.bottles++;eco.score+=b.pts;gFlower.petals.forEach(p=>p.tLen=Math.min(110,p.tLen+3));gFlower.sideFlowers.forEach(sf=>sf.bloom=Math.min(1,sf.bloom+.12));document.getElementById('g-bottles').textContent=eco.bottles;document.getElementById('g-score').textContent=eco.score;const rect=gCanvas.getBoundingClientRect();bloomFX(rect.left+b.x*(rect.width/gW),rect.top+by*(rect.height/gH));showToast(`â™»ï¸ +${b.pts} pts Â· Bloom ${Math.round(eco.bloom*100)}%`);return false;}
      return true;
    });
    // Polls
    polls=polls.filter(p=>{
      p.x+=p.vx;if(p.x<-30)return false;
      gCtx.font='18px serif';gCtx.textAlign='center';gCtx.textBaseline='middle';gCtx.fillText(p.e,p.x,p.y);
      if(Math.sqrt((rat.x-p.x)**2+(rat.y-p.y)**2)<18){lives--;document.getElementById('g-lives').textContent=['â™¥â™¥â™¥','â™¥â™¥','â™¥','âœ—'][Math.max(0,3-lives)];if(lives<=0){gRunning=false;drawGO();}showToast('ğŸ’¨ Pollution hit! Bloom -5%');eco.bottles=Math.max(0,eco.bottles-1);return false;}
      return true;
    });
  }

  // Rat
  const bg2=gCtx.createRadialGradient(rat.x,rat.y,2,rat.x,rat.y,18+bl*10);
  bg2.addColorStop(0,`rgba(255,160,40,${.15+bl*.12})`);bg2.addColorStop(1,'transparent');
  gCtx.fillStyle=bg2;gCtx.beginPath();gCtx.arc(rat.x,rat.y,18+bl*10,0,Math.PI*2);gCtx.fill();
  gCtx.save();gCtx.translate(rat.x,rat.y+Math.sin(rat.bob)*2.2);
  if(rat.face<0)gCtx.scale(-1,1);
  gCtx.font='22px serif';gCtx.textAlign='center';gCtx.textBaseline='middle';gCtx.fillText('ğŸ€',0,0);
  gCtx.restore();

  if(gRunning) requestAnimationFrame(gLoop);
}

function drawGO(){
  gCtx.fillStyle='rgba(6,8,10,.85)';gCtx.fillRect(0,0,gW,gH);
  gCtx.fillStyle='var(--cream)';gCtx.font='bold 28px Instrument Serif,serif';gCtx.textAlign='center';
  gCtx.fillStyle='#e8dcc8';gCtx.fillText('Game Over',gW/2,gH/2-14);
  gCtx.fillStyle='rgba(255,170,48,.7)';gCtx.font='14px Inter,sans-serif';
  gCtx.fillText('Score: '+eco.score,gW/2,gH/2+16);
  gCtx.fillText('Press Start to play again',gW/2,gH/2+40);
}

function startGame(){
  eco.bottles=0;eco.score=0;
  document.getElementById('g-score').textContent='0';document.getElementById('g-bottles').textContent='0';document.getElementById('g-level').textContent='1';document.getElementById('g-lives').textContent='â™¥â™¥â™¥';
  lives=3;level=1;frame=0;btimer=0;ptimer=0;bottles=[];polls=[];
  rat.x=80;rat.y=gH*.75;gFlower.init();gRunning=true;gLoop();
}
function resetGame(){
  gRunning=false;
  gCtx.fillStyle='#0d1117';gCtx.fillRect(0,0,gW,gH);
  gCtx.fillStyle='rgba(255,170,48,.4)';gCtx.font='14px Inter,sans-serif';gCtx.textAlign='center';
  gCtx.fillText('Press â–¶ Start to play',gW/2,gH/2);
}
window.startGame=startGame;window.resetGame=resetGame;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUIZ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let cQ=0,qSc=0;
function ans(btn,correct,qi){
  btn.parentElement.querySelectorAll('.q-opt').forEach(o=>o.disabled=true);
  if(correct){
    btn.classList.add('correct');qSc++;
    eco.quizBonus++;
    // Bloom FX at quiz button
    const r=btn.getBoundingClientRect();bloomFX(r.left+r.width/2,r.top+r.height/2);
    // GSAP pulse on quiz wrap
    gsap.fromTo('.quiz-wrap',{boxShadow:'0 0 0px rgba(255,170,48,0)'},{boxShadow:'0 0 40px rgba(255,170,48,.12)',duration:.35,yoyo:true,repeat:1});
    showToast('âœ“ Correct â€” the flower blooms!');
  } else {
    btn.classList.add('wrong');
    btn.parentElement.querySelectorAll('.q-opt').forEach(o=>{ if(o.onclick.toString().includes('true'))o.classList.add('correct'); });
  }
  document.getElementById('qb'+qi).classList.remove('cur');document.getElementById('qb'+qi).classList.add('done');
  setTimeout(()=>{
    document.getElementById('q'+qi).classList.remove('active');cQ++;
    const nq=document.getElementById('q'+cQ);
    if(nq){nq.classList.add('active');if(cQ<5)document.getElementById('qb'+cQ).classList.add('cur');}
    if(cQ>=5)setTimeout(()=>{
      document.getElementById('q5').classList.add('active');
      document.getElementById('q-final').textContent=qSc+'/5';
      document.getElementById('q-msg').textContent=['Keep learning â€” each step lets the world bloom ğŸŒ±','Good start! Your eco knowledge is growing ğŸŒ¿','Great work! You\'re helping the world bloom ğŸŒ¸','Excellent! A true eco champion ğŸ†','Perfect score â€” the world is in full bloom âœ¦'][qSc]||'';
    },200);
  },1100);
}
function resetQ(){
  cQ=0;qSc=0;
  document.querySelectorAll('.qbox').forEach(q=>q.classList.remove('active'));
  document.getElementById('q0').classList.add('active');
  document.querySelectorAll('.qb').forEach((d,i)=>{d.classList.remove('done','cur');if(i===0)d.classList.add('cur');});
  document.querySelectorAll('.q-opt').forEach(o=>{o.disabled=false;o.classList.remove('correct','wrong');});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(m){
  const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');
  clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove('show'),2800);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACKEND
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const db={pledges:[],lb:[{n:'EcoNinja',s:380},{n:'GreenSpark',s:260},{n:'AmberLeaf',s:195}]};

async function submitPledge(){
  const nm=document.getElementById('pname').value.trim(),tx=document.getElementById('ptext').value.trim();
  const r=document.getElementById('pledgeRes');
  if(!nm||!tx){r.textContent='Please fill both fields.';return;}
  r.innerHTML='<span class="ld"></span>Saving...';
  await new Promise(x=>setTimeout(x,900));
  db.pledges.push({nm,tx});
  r.textContent=`Pledge saved âœ“\n\n"${tx}"\nâ€” ${nm} Â· #${db.pledges.length} in our community`;
  showToast('Pledge submitted. The world thanks you.');
  document.getElementById('pname').value='';document.getElementById('ptext').value='';
}

async function getAITip(){
  const ls=document.getElementById('ls').value,ch=document.getElementById('ch').value;
  const r=document.getElementById('aiRes');
  r.innerHTML='<span class="ld"></span>Claude is thinking...';
  const lsl={student:'a student',parent:'a parent with young children',office:'an office worker',rural:'someone in rural living',urban:'an urban dweller'};
  const chl={plastic:'reducing plastic',energy:'saving energy',food:'food waste',transport:'green transport'};
  try{
    const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:200,messages:[{role:'user',content:`Give a single, practical eco tip for ${lsl[ls]} focused on ${chl[ch]}. Mention how small actions cause nature to bloom. 2-3 sentences max. No preamble.`}]})});
    const d=await resp.json();const tip=d.content?.[0]?.text;
    if(tip)r.textContent=tip;else throw 0;
  }catch{
    const fb={'student-plastic':'Carry a reusable bottle â€” every plastic bottle you refuse is one less pollutant. Small refusals bloom into real change.','office-energy':'Power off monitors and unplug chargers each night. A team that commits together watches energy savings bloom at scale.','parent-food':'Plan meals on Sunday to buy only what you need. Teaching kids to use everything plants seeds that bloom into lifelong habits.'};
    r.textContent=fb[ls+'-'+ch]||'Commit to one eco habit this week â€” whatever feels easiest. Small consistent actions bloom into meaningful impact over time.';
  }
}

function submitScore(){
  const nm=document.getElementById('lbname').value.trim();if(!nm){showToast('Enter your name first');return;}
  const s=eco.score+eco.quizBonus*15+eco.bottles*5;
  const ex=db.lb.find(e=>e.n.toLowerCase()===nm.toLowerCase());
  if(ex){if(s>ex.s){ex.s=s;showToast('New best: '+s+' pts ğŸ†');}else showToast('Your best is still '+ex.s);}
  else{db.lb.push({n:nm,s});showToast('Added to leaderboard!');}
  loadLB();
}
function loadLB(){
  const c=document.getElementById('lbDisplay');c.innerHTML='<span class="ld"></span>';
  setTimeout(()=>{
    const sorted=[...db.lb].sort((a,b)=>b.s-a.s);const med=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    c.innerHTML=sorted.slice(0,8).map((e,i)=>`<div class="lb-row"><div class="lb-r">${med[i]||i+1}</div><div class="lb-n">${e.n}</div><div class="lb-s">${e.s} pts</div></div>`).join('')||'<div style="color:var(--muted);font-size:.8rem;padding:6px 0">No scores yet.</div>';
  },400);
}
loadLB();
</script>
</body>
</html>
